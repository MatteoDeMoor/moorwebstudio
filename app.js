const translations = {
  nl: {
    meta: {
      title: "Moor Sites – Websites die bedrijven laten groeien.",
      description: "Digitale partner voor groei met op maat gemaakte websites.",
      ogTitle: "Moor Sites",
      ogDescription: "Websites die bedrijven laten groeien.",
      twitterTitle: "Moor Sites",
      twitterDescription: "Websites die bedrijven laten groeien.",
      schemaSlogan: "Websites die bedrijven laten groeien."
    },
    nav: {
      home: "Home",
      services: "Diensten",
      portfolio: "Aanbod",
      process: "Werkwijze",
      pricing: "Prijzen",
      about: "Over",
      contact: "Contact",
      cta: "Offerte aanvragen",
      aria: "Hoofdnavigatie",
      menu: "Menu"
    },
    hero: {
      eyebrow: "DIGITALE GROEIPARTNER",
      subtitle: "Websites die moeiteloos resultaat opleveren.",
      pitch: "We combineren strategie, design en development tot digitale ervaringen die je bedrijf vooruit helpen.",
      primaryCta: "Offerte aanvragen",
      secondaryCta: "Aanbod ontdekken"
    },
    services: {
      eyebrow: "WAAR WE IN UITBLINKEN",
      title: "End-to-end weboplossingen",
      description: "Van strategie tot lancering: wij leveren digitale platforms die de lat hoger leggen voor performance, uitstraling en conversie.",
      webdesign: {
        title: "Webdesign",
        text: "Visuele identiteiten vertaald naar gebruiksvriendelijke interfaces met focus op merkbeleving.",
        bullets: [
          "Custom UI/UX ontwerp",
          "Volledig responsive layouts",
          "Designsystemen & componenten"
        ]
      },
      development: {
        title: "Development",
        text: "Schaalbare front-end ontwikkeling met oog voor detail, snelheid en beheerbaarheid.",
        bullets: [
          "Schoon gestructureerde code",
          "CMS-koppelingen op maat",
          "Toegankelijkheidsrichtlijnen (AA)"
        ]
      },
      optimization: {
        title: "Optimalisatie",
        text: "Continue groei via data, testing en optimalisatie voor betere resultaten.",
        bullets: [
          "Core Web Vitals tuning",
          "SEO-basis en structuur",
          "Prestatie- en conversietests"
        ]
      }
    },
    portfolio: {
      eyebrow: "ONS AANBOD",
      title: "Digitale oplossingen die we opleveren",
      description: "Geen cases, wel de trajecten en deliverables waarmee we jouw groei versnellen.",
      filters: {
        all: "Alles",
        landing: "Websites",
        shop: "Webshops",
        corporate: "Groei & support"
      },
      hover: "Bekijk aanbod",
      items: [
        {
          title: "Conversiegerichte one-pagers",
          text: "Snel gelanceerde landingspagina's met sterke copy, tracking en conversie-elementen.",
          tags: ["Snel live", "SEO-ready"]
        },
        {
          title: "Merkwebsites op maat",
          text: "Modulaire websites afgestemd op je merkverhaal, klaar voor CMS-beheer.",
          tags: ["UX design", "CMS"]
        },
        {
          title: "Leadgeneratieplatformen",
          text: "Funnels met gated content, automatisatie en integraties die sales versterken.",
          tags: ["Lead nurturing", "Integraties"]
        },
        {
          title: "Campagne- & eventpagina's",
          text: "Microsites voor campagnes en events met focus op activatie en conversie.",
          tags: ["Sprints", "Conversie"]
        },
        {
          title: "E-commerce ervaringen",
          text: "Performante webshops met optimale checkout en data-gedreven optimalisaties.",
          tags: ["Checkout", "Analytics"]
        },
        {
          title: "Groei- en supporttrajecten",
          text: "Doorlopende optimalisatie, onderhoud en support met een vaste digitale partner.",
          tags: ["Monitoring", "Optimalisatie"]
        }
      ],
      highlight: {
        title: "Waarom teams voor Moor Sites kiezen",
        text: "We koppelen strategie aan design en development zodat jouw site blijft presteren.",
        stats: ["Klanttevredenheid", "Snellere laadtijden"]
      }
    },
    process: {
      eyebrow: "WERKWIJZE",
      title: "Samen bouwen we aan groei",
      description: "Een transparant traject met duidelijke milestones en continue communicatie.",
      steps: [
        { title: "Intake", text: "We duiken in doelen, doelgroep en businessmodel om het project scherp te stellen." },
        { title: "Analyse", text: "Data en inzichten vertalen we naar een heldere roadmap met prioriteiten." },
        { title: "Design", text: "Wireframes en high-fidelity designs afgestemd op merkidentiteit en conversie." },
        { title: "Development", text: "Pixel-perfect implementatie met focus op performance en beheerbaarheid." },
        { title: "Launch & Growth", text: "Oplevering, training en doorlopende optimalisaties voor blijvende impact." }
      ]
    },
    pricing: {
      eyebrow: "PRIJZEN",
      title: "Pakketten afgestemd op ambitie",
      description: "Transparante formules die meegroeien met uw organisatie.",
      featured: "Meest gekozen",
      cta: "Offerte aanvragen",
      plans: [
        {
          name: "Starter",
          price: "€3.950",
          features: [
            "One-page of compacte site",
            "Responsive design",
            "SEO-basis inrichting",
            "1 maand ondersteuning"
          ]
        },
        {
          name: "Pro",
          price: "€6.950",
          features: [
            "Tot 10 pagina's op maat",
            "CMS implementatie",
            "Performance optimalisatie",
            "3 maanden support"
          ]
        },
        {
          name: "Growth",
          price: "€9.950",
          features: [
            "Uitgebreide site of webshop",
            "Marketing integraties",
            "Conversion tracking",
            "6 maanden optimalisatie"
          ]
        }
      ]
    },
    about: {
      eyebrow: "OVER ONS",
      title: "Matteo De Moor",
      description: "Digital strategist en maker met een passie voor schaalbare interfaces en meetbare resultaten.",
      skills: ["HTML", "CSS", "JavaScript", "Performance", "Toegankelijkheid", "UX/UI"],
      badges: [
        { value: "10+", label: "Jaar ervaring" },
        { value: "98%", label: "Klanttevredenheid" }
      ]
    },
    testimonials: {
      eyebrow: "SOCIAL PROOF",
      title: "Wat klanten zeggen",
      description: "Teams vertrouwen op Moor Sites om digitale ambities waar te maken.",
      carouselAria: "Klantreacties slider",
      items: [
        {
          quote: "\"De combinatie van strategie en pixel-perfect uitvoering leverde een website op die echt converteert.\"",
          author: "Sophie Vermeulen – Marketing Manager"
        },
        {
          quote: "\"Ons ecommerce-platform draait sneller dan ooit en het team blijft optimaliseren op basis van data.\"",
          author: "Tom Jacobs – Founder Aurora"
        },
        {
          quote: "\"Heldere aanpak, sterke communicatie en een resultaat waar ons sales-team elke dag van profiteert.\"",
          author: "Leen Martens – Partner Beacon"
        }
      ],
      prev: "Vorige testimonial",
      next: "Volgende testimonial"
    },
    contact: {
      eyebrow: "CONTACT",
      title: "Klaar om te groeien?",
      description: "Vertel ons over uw project en we nemen binnen 24 uur contact op.",
      info: {
        title: "Direct contact",
        text: "Liever persoonlijk? We staan klaar voor een gesprek.",
        email: "hello@moorsites.be",
        phone: "+32 470 12 34 56",
        location: "Gent, België"
      },
      form: {
        name: {
          label: "Naam",
          placeholder: "Uw naam",
          error: "Gelieve uw naam in te vullen."
        },
        email: {
          label: "E-mail",
          placeholder: "naam@bedrijf.com",
          error: "Vul een geldig e-mailadres in."
        },
        company: {
          label: "Bedrijf (optioneel)",
          placeholder: "Bedrijfsnaam"
        },
        budget: {
          label: "Budget",
          placeholder: "Selecteer budget",
          options: ["€3k – €5k", "€5k – €10k", "€10k+"],
          error: "Selecteer een budgetindicatie."
        },
        message: {
          label: "Bericht",
          placeholder: "Vertel ons over uw project",
          error: "Beschrijf kort uw project."
        },
        submit: "Verstuur bericht",
        success: "Bedankt! We nemen snel contact op."
      }
    },
    footer: {
      tagline: "Websites die bedrijven laten groeien.",
      links: "Snel naar",
      follow: "Volg ons",
      credits: "Gemaakt door Moor Sites"
    }
  },
  en: {
    meta: {
      title: "Moor Sites – Websites that help businesses grow.",
      description: "Digital partner for growth with tailor-made websites.",
      ogTitle: "Moor Sites",
      ogDescription: "Websites that help businesses grow.",
      twitterTitle: "Moor Sites",
      twitterDescription: "Websites that help businesses grow.",
      schemaSlogan: "Websites that help businesses grow."
    },
    nav: {
      home: "Home",
      services: "Services",
      portfolio: "Offerings",
      process: "Process",
      pricing: "Pricing",
      about: "About",
      contact: "Contact",
      cta: "Request a quote",
      aria: "Primary navigation",
      menu: "Menu"
    },
    hero: {
      eyebrow: "DIGITAL GROWTH PARTNER",
      subtitle: "Websites engineered for measurable outcomes.",
      pitch: "We blend strategy, design, and development into digital experiences that keep your business moving forward.",
      primaryCta: "Request a quote",
      secondaryCta: "View offerings"
    },
    services: {
      eyebrow: "WHAT WE DO",
      title: "End-to-end web solutions",
      description: "From strategy to launch, we deliver digital platforms engineered for performance, presence, and conversion.",
      webdesign: {
        title: "Web Design",
        text: "Visual identities translated into intuitive interfaces with a focus on brand experience.",
        bullets: [
          "Custom UI/UX design",
          "Fully responsive layouts",
          "Design systems & components"
        ]
      },
      development: {
        title: "Development",
        text: "Scalable front-end development built for speed, detail, and maintainability.",
        bullets: [
          "Clean, structured code",
          "Tailored CMS integrations",
          "Accessibility compliance (AA)"
        ]
      },
      optimization: {
        title: "Optimization",
        text: "Continuous growth through data, testing, and iterative improvements.",
        bullets: [
          "Core Web Vitals tuning",
          "SEO foundations",
          "Performance & conversion tests"
        ]
      }
    },
    portfolio: {
      eyebrow: "OFFERINGS",
      title: "Digital outcomes we deliver",
      description: "Explore the deliverables and programs we build to accelerate your growth.",
      filters: {
        all: "All",
        landing: "Websites",
        shop: "Online stores",
        corporate: "Growth & support"
      },
      hover: "View offering",
      items: [
        {
          title: "Conversion-ready landing pages",
          text: "Launch fast with persuasive copy, tracking, and components built to convert.",
          tags: ["Fast launch", "SEO-ready"]
        },
        {
          title: "Custom brand websites",
          text: "Modular websites tailored to your story and ready for intuitive CMS management.",
          tags: ["UX design", "CMS"]
        },
        {
          title: "Lead generation platforms",
          text: "Funnels with gated content, automation, and integrations that power sales.",
          tags: ["Lead nurturing", "Integrations"]
        },
        {
          title: "Campaign & event hubs",
          text: "High-impact microsites for launches, events, and campaigns with conversion focus.",
          tags: ["Sprints", "Conversion"]
        },
        {
          title: "Ecommerce experiences",
          text: "High-performing storefronts with streamlined checkout and data-driven optimization.",
          tags: ["Checkout", "Analytics"]
        },
        {
          title: "Growth & support programs",
          text: "Ongoing optimization, maintenance, and support from a dedicated digital partner.",
          tags: ["Monitoring", "Optimization"]
        }
      ],
      highlight: {
        title: "Why teams choose Moor Sites",
        text: "Strategy, design, and development working together so your site keeps delivering.",
        stats: ["Client satisfaction", "Faster load times"]
      }
    },
    process: {
      eyebrow: "PROCESS",
      title: "Co-creating growth",
      description: "A transparent journey with clear milestones and consistent communication.",
      steps: [
        { title: "Discovery", text: "We explore objectives, audience, and business model to define scope." },
        { title: "Analysis", text: "Insights turn into a sharp roadmap with aligned priorities." },
        { title: "Design", text: "Wireframes and high-fidelity designs aligned with brand and conversion." },
        { title: "Development", text: "Pixel-perfect implementation focused on performance and maintainability." },
        { title: "Launch & Growth", text: "Go-live, enablement, and continuous optimization for lasting impact." }
      ]
    },
    pricing: {
      eyebrow: "PRICING",
      title: "Packages built for ambition",
      description: "Transparent plans that scale with your organization.",
      featured: "Most popular",
      cta: "Request a quote",
      plans: [
        {
          name: "Starter",
          price: "€3,950",
          features: [
            "Single-page or compact site",
            "Responsive design",
            "SEO foundations",
            "1 month support"
          ]
        },
        {
          name: "Pro",
          price: "€6,950",
          features: [
            "Up to 10 tailored pages",
            "CMS implementation",
            "Performance optimization",
            "3 months support"
          ]
        },
        {
          name: "Growth",
          price: "€9,950",
          features: [
            "Large website or ecommerce",
            "Marketing integrations",
            "Conversion tracking",
            "6 months optimization"
          ]
        }
      ]
    },
    about: {
      eyebrow: "ABOUT",
      title: "Matteo De Moor",
      description: "Digital strategist and maker focused on scalable interfaces and measurable outcomes.",
      skills: ["HTML", "CSS", "JavaScript", "Performance", "Accessibility", "UX/UI"],
      badges: [
        { value: "10+", label: "Years experience" },
        { value: "98%", label: "Client satisfaction" }
      ]
    },
    testimonials: {
      eyebrow: "SOCIAL PROOF",
      title: "What clients say",
      description: "Teams rely on Moor Sites to unlock digital ambitions.",
      carouselAria: "Client stories slider",
      items: [
        {
          quote: "\"The mix of strategy and pixel-perfect execution delivered a site that truly converts.\"",
          author: "Sophie Vermeulen – Marketing Manager"
        },
        {
          quote: "\"Our ecommerce platform runs faster than ever and the team keeps optimizing with data.\"",
          author: "Tom Jacobs – Founder Aurora"
        },
        {
          quote: "\"Clear process, strong communication, and results our sales team benefits from daily.\"",
          author: "Leen Martens – Partner Beacon"
        }
      ],
      prev: "Previous testimonial",
      next: "Next testimonial"
    },
    contact: {
      eyebrow: "CONTACT",
      title: "Ready to accelerate?",
      description: "Share your project and we'll be in touch within 24 hours.",
      info: {
        title: "Reach out",
        text: "Prefer a direct chat? We're just a message away.",
        email: "hello@moorsites.be",
        phone: "+32 470 12 34 56",
        location: "Ghent, Belgium"
      },
      form: {
        name: {
          label: "Name",
          placeholder: "Your name",
          error: "Please enter your name."
        },
        email: {
          label: "Email",
          placeholder: "you@company.com",
          error: "Enter a valid email address."
        },
        company: {
          label: "Company (optional)",
          placeholder: "Company name"
        },
        budget: {
          label: "Budget",
          placeholder: "Select budget",
          options: ["€3k – €5k", "€5k – €10k", "€10k+"],
          error: "Choose a budget range."
        },
        message: {
          label: "Message",
          placeholder: "Tell us about your project",
          error: "Please describe your project."
        },
        submit: "Send message",
        success: "Thank you! We'll be in touch shortly."
      }
    },
    footer: {
      tagline: "Websites that help businesses grow.",
      links: "Quick links",
      follow: "Follow us",
      credits: "Crafted by Moor Sites"
    }
  }
};

const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

const languageButtons = document.querySelectorAll('.language-toggle__button');
const rootElement = document.documentElement;
const nav = document.querySelector('.nav');
const navMenu = document.querySelector('.nav__menu');
const navToggle = document.querySelector('.nav__toggle');
const navLinks = document.querySelectorAll('.nav__link');
const sections = document.querySelectorAll('main section');
const portfolioFilters = document.querySelectorAll('.portfolio__filter');
const portfolioCards = document.querySelectorAll('.portfolio-card');
const counterElements = document.querySelectorAll('.portfolio-highlight__number');
const processSteps = document.querySelectorAll('.process-step');
const testimonialTrack = document.querySelector('.testimonial-slider__track');
const testimonialSlides = document.querySelectorAll('.testimonial');
const testimonialButtons = document.querySelectorAll('.testimonial-slider__button');
const contactForm = document.querySelector('.contact-form');
const schemaScript = document.getElementById('organization-schema');
const sliderContainer = document.querySelector('.testimonial-slider');

const storedLang = localStorage.getItem('moorsites-lang') || localStorage.getItem('ogoconcept-lang');
let activeLang = storedLang || 'nl';
let currentSlide = 0;
let sliderInterval;

const updateMetaTags = (langKey) => {
  const meta = translations[langKey].meta;
  document.title = meta.title;
  const descriptionTag = document.querySelector('meta[name="description"]');
  if (descriptionTag) descriptionTag.setAttribute('content', meta.description);
  const ogTitle = document.querySelector('meta[property="og:title"]');
  const ogDescription = document.querySelector('meta[property="og:description"]');
  const twitterTitle = document.querySelector('meta[name="twitter:title"]');
  const twitterDescription = document.querySelector('meta[name="twitter:description"]');
  if (ogTitle) ogTitle.setAttribute('content', meta.ogTitle);
  if (ogDescription) ogDescription.setAttribute('content', meta.ogDescription);
  if (twitterTitle) twitterTitle.setAttribute('content', meta.twitterTitle);
  if (twitterDescription) twitterDescription.setAttribute('content', meta.twitterDescription);
  if (schemaScript) {
    try {
      const schema = JSON.parse(schemaScript.textContent);
      schema.slogan = meta.schemaSlogan;
      schemaScript.textContent = JSON.stringify(schema, null, 2);
    } catch (error) {
      console.error('Schema update failed', error);
    }
  }
};

const applyTranslations = (langKey) => {
  const dictionary = translations[langKey];
  document.querySelectorAll('[data-i18n]').forEach((node) => {
    const keys = node.dataset.i18n.split('.');
    let value = dictionary;
    for (const key of keys) {
      value = value?.[key];
    }
    if (typeof value === 'string') {
      node.textContent = value;
    } else if (Array.isArray(value)) {
      // handle arrays for list items
      const children = node.querySelectorAll('[data-i18n-array-item]');
      value.forEach((text, index) => {
        const child = children[index];
        if (child) child.textContent = text;
      });
    }
  });

  document.querySelectorAll('[data-placeholder]').forEach((input) => {
    const keys = input.dataset.placeholder.split('.');
    let value = dictionary;
    for (const key of keys) {
      value = value?.[key];
    }
    if (typeof value === 'string') {
      input.setAttribute('placeholder', value);
    }
  });

  document.querySelectorAll('option[data-i18n]').forEach((option) => {
    const keys = option.dataset.i18n.split('.');
    let value = dictionary;
    for (const key of keys) {
      value = value?.[key];
    }
    if (typeof value === 'string') {
      option.textContent = value;
    }
  });

  document.querySelectorAll('[data-i18n-hover]').forEach((node) => {
    const keys = node.dataset.i18nHover.split('.');
    let value = dictionary;
    for (const key of keys) {
      value = value?.[key];
    }
    if (typeof value === 'string') {
      node.setAttribute('data-hover', value);
      node.setAttribute('data-label', value);
    }
  });

  const navElement = document.querySelector('nav[aria-label]');
  if (navElement) {
    navElement.setAttribute('aria-label', dictionary.nav.aria);
  }
  if (navToggle) {
    navToggle.setAttribute('aria-label', dictionary.nav.menu);
  }
  if (sliderContainer) {
    sliderContainer.setAttribute('aria-label', dictionary.testimonials.carouselAria);
  }
  testimonialButtons.forEach((button) => {
    const direction = button.dataset.direction;
    const label = direction === 'prev' ? dictionary.testimonials.prev : dictionary.testimonials.next;
    button.setAttribute('aria-label', label);
  });

  document.querySelectorAll('a[href^="mailto:"]').forEach((link) => {
    link.textContent = dictionary.contact.info.email;
  });
  document.querySelectorAll('a[href^="tel:"]').forEach((link) => {
    link.textContent = dictionary.contact.info.phone;
  });

  const locationNode = document.querySelector('.contact__info-list li:last-child');
  if (locationNode) {
    locationNode.textContent = dictionary.contact.info.location;
  }

  document.querySelectorAll('.about__badge').forEach((badge, index) => {
    const valueNode = badge.querySelector('.about__badge-number');
    const labelNode = badge.querySelector('.about__badge-label');
    const data = dictionary.about.badges[index];
    if (data) {
      if (valueNode) valueNode.textContent = data.value;
      if (labelNode) labelNode.textContent = data.label;
    }
  });

  document.querySelectorAll('.about__skills li').forEach((item, index) => {
    const value = dictionary.about.skills[index];
    if (value) item.textContent = value;
  });

  document.querySelectorAll('.service-card').forEach((card, index) => {
    const serviceKey = ['webdesign', 'development', 'optimization'][index];
    if (!serviceKey) return;
    const serviceData = dictionary.services[serviceKey];
    const bulletItems = card.querySelectorAll('.service-card__list li');
    serviceData.bullets.forEach((text, bulletIndex) => {
      const bullet = bulletItems[bulletIndex];
      if (bullet) bullet.textContent = text;
    });
  });

  portfolioCards.forEach((card, index) => {
    const data = dictionary.portfolio.items[index];
    if (!data) return;
    const tags = card.querySelectorAll('.portfolio-card__tags li');
    tags.forEach((tag, tagIndex) => {
      tag.textContent = data.tags[tagIndex] || '';
    });
  });

  document.querySelectorAll('.pricing-card').forEach((card, index) => {
    const planData = dictionary.pricing.plans[index];
    if (!planData) return;
    const features = card.querySelectorAll('.pricing-card__features li');
    features.forEach((feature, featureIndex) => {
      feature.textContent = planData.features[featureIndex] || '';
    });
  });

  testimonialSlides.forEach((slide, index) => {
    const quoteNode = slide.querySelector('.testimonial__quote');
    const authorNode = slide.querySelector('.testimonial__author');
    const data = dictionary.testimonials.items[index];
    if (data) {
      if (quoteNode) quoteNode.textContent = data.quote;
      if (authorNode) authorNode.textContent = data.author;
    }
  });

  document.querySelectorAll('.contact-form__error').forEach((errorNode) => {
    const keys = errorNode.dataset.i18n.split('.');
    let value = dictionary;
    for (const key of keys) {
      value = value?.[key];
    }
    if (typeof value === 'string') {
      errorNode.textContent = value;
    }
  });

  const successNode = document.querySelector('.contact-form__success');
  if (successNode) {
    const keys = successNode.dataset.i18n.split('.');
    let value = dictionary;
    for (const key of keys) {
      value = value?.[key];
    }
    if (typeof value === 'string') {
      successNode.textContent = value;
    }
  }

  updateMetaTags(langKey);
};

const setLanguage = (langKey) => {
  activeLang = langKey;
  rootElement.lang = langKey;
  languageButtons.forEach((button) => {
    const isActive = button.dataset.lang === langKey;
    button.classList.toggle('is-active', isActive);
    button.setAttribute('aria-pressed', String(isActive));
  });
  applyTranslations(langKey);
  localStorage.setItem('moorsites-lang', langKey);
  localStorage.removeItem('ogoconcept-lang');
};

languageButtons.forEach((button) => {
  button.addEventListener('click', () => setLanguage(button.dataset.lang));
});

const setNavScrolled = () => {
  if (!nav) return;
  nav.classList.toggle('is-scrolled', window.scrollY > 20);
};

const closeMenu = () => {
  navMenu.classList.remove('is-open');
  navToggle.setAttribute('aria-expanded', 'false');
};

if (navToggle) {
  navToggle.addEventListener('click', () => {
    const isOpen = navMenu.classList.toggle('is-open');
    navToggle.setAttribute('aria-expanded', String(isOpen));
  });
}

navLinks.forEach((link) => {
  link.addEventListener('click', () => {
    if (window.innerWidth <= 960) {
      closeMenu();
    }
  });
});

window.addEventListener('scroll', setNavScrolled);
setNavScrolled();

const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      const id = entry.target.getAttribute('id');
      navLinks.forEach((link) => {
        const href = link.getAttribute('href');
        const matches = href === `#${id}`;
        link.classList.toggle('is-active', matches);
      });
    }
  });
}, { threshold: 0.5 });

sections.forEach((section) => observer.observe(section));

if (!prefersReducedMotion) {
  const counterObserver = new IntersectionObserver((entries, obs) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const node = entry.target;
        const target = parseInt(node.dataset.target, 10);
        let current = 0;
        const increment = Math.ceil(target / 50);
        const updateCounter = () => {
          current += increment;
          if (current >= target) {
            node.textContent = `${target}%`;
            clearInterval(timer);
          } else {
            node.textContent = `${current}%`;
          }
        };
        const timer = setInterval(updateCounter, 30);
        obs.unobserve(node);
      }
    });
  }, { threshold: 0.5 });

  counterElements.forEach((element) => counterObserver.observe(element));
}

const processObserver = new IntersectionObserver((entries, obs) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.classList.add('is-visible');
      obs.unobserve(entry.target);
    }
  });
}, { threshold: 0.3 });

processSteps.forEach((step) => processObserver.observe(step));

portfolioFilters.forEach((button) => {
  button.addEventListener('click', () => {
    portfolioFilters.forEach((btn) => btn.classList.remove('is-active'));
    button.classList.add('is-active');
    const filter = button.dataset.filter;
    portfolioCards.forEach((card) => {
      const match = filter === 'all' || card.dataset.category === filter;
      card.style.display = match ? '' : 'none';
    });
  });
});

const moveSlider = (direction) => {
  const totalSlides = testimonialSlides.length;
  currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
  testimonialTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
};

testimonialButtons.forEach((button) => {
  button.addEventListener('click', () => {
    const direction = button.dataset.direction === 'next' ? 1 : -1;
    moveSlider(direction);
    restartSlider();
  });
});

const startSlider = () => {
  if (prefersReducedMotion) return;
  sliderInterval = setInterval(() => moveSlider(1), 6000);
};

const restartSlider = () => {
  if (sliderInterval) clearInterval(sliderInterval);
  startSlider();
};

if (sliderContainer) {
  sliderContainer.addEventListener('mouseenter', () => sliderInterval && clearInterval(sliderInterval));
  sliderContainer.addEventListener('mouseleave', restartSlider);
}

startSlider();

if (prefersReducedMotion) {
  processSteps.forEach((step) => step.classList.add('is-visible'));
}

const validateField = (input) => {
  const group = input.closest('.contact-form__group');
  if (!group) return true;
  const errorNode = group.querySelector('.contact-form__error');
  let isValid = true;

  if (input.type === 'email') {
    isValid = input.value.trim() !== '' && input.checkValidity();
  } else if (input.tagName === 'SELECT') {
    isValid = input.value.trim() !== '';
  } else if (input.hasAttribute('required')) {
    isValid = input.value.trim() !== '';
  }

  if (!isValid) {
    errorNode?.classList.add('is-visible');
  } else {
    errorNode?.classList.remove('is-visible');
  }
  return isValid;
};

contactForm?.querySelectorAll('input, textarea, select').forEach((field) => {
  field.addEventListener('blur', () => validateField(field));
});

contactForm?.addEventListener('submit', (event) => {
  event.preventDefault();
  let formIsValid = true;
  const fields = contactForm.querySelectorAll('input, textarea, select');
  fields.forEach((field) => {
    if (!validateField(field)) {
      formIsValid = false;
    }
  });
  const successNode = contactForm.querySelector('.contact-form__success');
  if (formIsValid) {
    successNode?.classList.add('is-visible');
    contactForm.reset();
    fields.forEach((field) => {
      if (field.dataset.placeholder) {
        field.dispatchEvent(new Event('blur'));
      }
    });
    fields.forEach((field) => {
      const group = field.closest('.contact-form__group');
      group?.querySelector('.contact-form__error')?.classList.remove('is-visible');
    });
  } else {
    successNode?.classList.remove('is-visible');
  }
});

const yearNode = document.getElementById('current-year');
if (yearNode) {
  yearNode.textContent = new Date().getFullYear();
}

setLanguage(activeLang);
if (navLinks.length) {
  navLinks[0].classList.add('is-active');
}
